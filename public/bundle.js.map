{
  "version": 3,
  "sources": ["ts/state.ts", "ts/model-selector.ts", "ts/image-paste.ts", "ts/ui-utils.ts", "ts/history.ts", "ts/session-panel.ts", "ts/main.ts", "ts/activity.ts", "ts/display-output.ts", "ts/streaming.ts"],
  "sourcesContent": ["/**\n * Client State Store\n * \n * Single source of truth for client-side application state.\n * All mutable state lives here; modules import getters/setters.\n */\n\nimport type { ModelInfo } from './types.js';\n\n// ============================================================\n// State Interface\n// ============================================================\n\nexport interface AppState {\n  // Session state (synced from server)\n  activeSessionId: string | null;\n  currentCwd: string;\n  \n  // Model state\n  selectedModel: string;\n  \n  // Streaming state (transient)\n  isStreaming: boolean;\n  activeEventSource: EventSource | null;\n  \n  // Image attachment state\n  hasImage: boolean;\n}\n\n// ============================================================\n// Constants\n// ============================================================\n\n// Single source of truth for default model (client-side)\nexport const DEFAULT_MODEL = 'claude-sonnet-4';\n\n// ============================================================\n// State Store (singleton)\n// ============================================================\n\nconst state: AppState = {\n  activeSessionId: null,\n  currentCwd: '',\n  selectedModel: DEFAULT_MODEL,\n  isStreaming: false,\n  activeEventSource: null,\n  hasImage: false\n};\n\n// ============================================================\n// State Accessors (read-only access)\n// ============================================================\n\n/**\n * Get a shallow copy of current state (for debugging/inspection)\n */\nexport function getState(): Readonly<AppState> {\n  return { ...state };\n}\n\n/**\n * Get current active session ID\n */\nexport function getActiveSessionId(): string | null {\n  return state.activeSessionId;\n}\n\n/**\n * Get current working directory\n */\nexport function getCurrentCwd(): string {\n  return state.currentCwd;\n}\n\n/**\n * Get currently selected model\n */\nexport function getSelectedModel(): string {\n  return state.selectedModel;\n}\n\n/**\n * Check if currently streaming\n */\nexport function isStreaming(): boolean {\n  return state.isStreaming;\n}\n\n/**\n * Get active event source (for stopping)\n */\nexport function getActiveEventSource(): EventSource | null {\n  return state.activeEventSource;\n}\n\n/**\n * Check if image is attached\n */\nexport function hasImage(): boolean {\n  return state.hasImage;\n}\n\n// ============================================================\n// State Mutations (explicit, trackable)\n// ============================================================\n\n/**\n * Set active session (from server response)\n */\nexport function setActiveSession(sessionId: string | null, cwd: string): void {\n  state.activeSessionId = sessionId;\n  state.currentCwd = cwd;\n}\n\n/**\n * Set selected model and sync to hidden input\n */\nexport function setSelectedModel(modelId: string): void {\n  state.selectedModel = modelId;\n  \n  // Sync to hidden form input\n  const input = document.getElementById('selectedModel') as HTMLInputElement | null;\n  if (input) {\n    input.value = modelId;\n  }\n}\n\n/**\n * Set streaming state\n */\nexport function setStreaming(streaming: boolean, eventSource: EventSource | null = null): void {\n  state.isStreaming = streaming;\n  state.activeEventSource = eventSource;\n}\n\n/**\n * Set image attachment state\n */\nexport function setHasImage(hasImage: boolean): void {\n  state.hasImage = hasImage;\n}\n\n// ============================================================\n// Initialization\n// ============================================================\n\n/**\n * Initialize state from server preferences\n */\nexport function initFromPreferences(prefs: { \n  lastModel?: string; \n  lastCwd?: string;\n  lastSessionId?: string | null;\n}): void {\n  if (prefs.lastModel) {\n    setSelectedModel(prefs.lastModel);\n  }\n  if (prefs.lastCwd) {\n    state.currentCwd = prefs.lastCwd;\n  }\n  if (prefs.lastSessionId !== undefined) {\n    state.activeSessionId = prefs.lastSessionId;\n  }\n}\n\n/**\n * Initialize from session response\n */\nexport function initFromSession(data: {\n  sessionId?: string | null;\n  cwd?: string;\n  activeSessionId?: string | null;\n  currentCwd?: string;\n}): void {\n  // Handle both /api/session and /api/sessions response formats\n  const sessionId = data.sessionId ?? data.activeSessionId ?? null;\n  const cwd = data.cwd ?? data.currentCwd ?? '';\n  \n  setActiveSession(sessionId, cwd);\n}\n", "/**\n * Model selection\n */\n\nimport type { ModelInfo, Preferences } from './types.js';\nimport { getSelectedModel, setSelectedModel as stateSetSelectedModel } from './state.js';\n\n/**\n * Fallback model list (used if SDK doesn't return models)\n */\nconst FALLBACK_MODELS: ModelInfo[] = [\n  { id: 'claude-sonnet-4', name: 'Claude Sonnet 4', cost: 1 },\n  { id: 'claude-sonnet-4.5', name: 'Claude Sonnet 4.5', cost: 1 },\n  { id: 'claude-opus-4.5', name: 'Claude Opus 4.5', cost: 3 },\n  { id: 'claude-haiku-4.5', name: 'Claude Haiku 4.5', cost: 0.33 },\n  { id: 'gpt-4.1', name: 'GPT-4.1', cost: 0 },\n  { id: 'gpt-4o', name: 'GPT-4o', cost: 0 }\n];\n\n// Models from server (set by setAvailableModels)\nlet availableModels: ModelInfo[] = [];\n\n/**\n * Set available models from server response\n */\nexport function setAvailableModels(models: ModelInfo[]): void {\n  availableModels = models;\n  console.log(`[MODEL] Available models from SDK:`, models.map(m => m.id));\n}\n\n/**\n * Get models to display (server models or fallback)\n */\nfunction getModels(): ModelInfo[] {\n  return availableModels.length > 0 ? availableModels : FALLBACK_MODELS;\n}\n\n/**\n * Show the new chat form (for new sessions with no messages)\n */\nexport function showNewChat(prefillCwd?: string): void {\n  const newChat = document.getElementById('newChat');\n  const chat = document.getElementById('chat');\n  const cwdInput = document.getElementById('newChatCwd') as HTMLInputElement;\n  const errorDiv = document.getElementById('newChatError');\n  \n  if (newChat && chat) {\n    newChat.classList.remove('hidden');\n    chat.classList.add('hidden');\n    \n    // Clear any previous error\n    if (errorDiv) errorDiv.textContent = '';\n    \n    // Pre-fill cwd if provided\n    if (cwdInput && prefillCwd) {\n      cwdInput.value = prefillCwd;\n    }\n    \n    // Render models (already loaded on page init)\n    loadModels();\n  }\n}\n\n/**\n * Hide the new chat form and show chat (when messages exist)\n */\nexport function hideNewChat(): void {\n  const newChat = document.getElementById('newChat');\n  const chat = document.getElementById('chat');\n  \n  if (newChat && chat) {\n    newChat.classList.add('hidden');\n    chat.classList.remove('hidden');\n  }\n}\n\n/**\n * Get the cwd from the new chat form\n */\nexport function getNewChatCwd(): string {\n  const cwdInput = document.getElementById('newChatCwd') as HTMLInputElement;\n  return cwdInput?.value.trim() || '';\n}\n\n/**\n * Show error in new chat form\n */\nexport function showNewChatError(message: string): void {\n  const errorDiv = document.getElementById('newChatError');\n  if (errorDiv) errorDiv.textContent = message;\n}\n\n/**\n * Load and render model list\n */\nexport function loadModels(): void {\n  const container = document.getElementById('modelList');\n  if (!container) return;\n  \n  container.innerHTML = '';\n  const currentModel = getSelectedModel();\n  const models = getModels();\n  \n  for (const model of models) {\n    const item = document.createElement('div');\n    item.className = 'model-item';\n    if (model.id === currentModel) {\n      item.classList.add('active');\n    }\n    item.dataset.modelId = model.id;\n    item.onclick = () => selectModel(model.id);\n    \n    // Model name\n    const nameSpan = document.createElement('span');\n    nameSpan.className = 'model-name';\n    nameSpan.textContent = model.name;\n    item.appendChild(nameSpan);\n    \n    // Cost indicator\n    const costSpan = document.createElement('span');\n    costSpan.className = 'model-cost';\n    if (model.cost === 0) {\n      costSpan.textContent = 'free';\n      costSpan.classList.add('free');\n    } else if (model.cost < 1) {\n      costSpan.textContent = `${model.cost}x`;\n      costSpan.classList.add('cheap');\n    } else if (model.cost > 1) {\n      costSpan.textContent = `${model.cost}x`;\n      costSpan.classList.add('expensive');\n    } else {\n      costSpan.textContent = '1x';\n    }\n    item.appendChild(costSpan);\n    \n    container.appendChild(item);\n  }\n}\n\n/**\n * Select a model (just updates state and UI highlight)\n */\nexport function selectModel(modelId: string): void {\n  // Update state (also syncs hidden input)\n  stateSetSelectedModel(modelId);\n  \n  // Update placeholder to show selected model\n  const models = getModels();\n  const modelInfo = models.find(m => m.id === modelId);\n  if (modelInfo) {\n    const input = document.querySelector('input[name=\"message\"]') as HTMLInputElement;\n    if (input) {\n      input.placeholder = `Ask ${modelInfo.name}...`;\n    }\n  }\n  \n  // Update active state in list\n  const items = document.querySelectorAll('.model-item');\n  items.forEach(item => {\n    if ((item as HTMLElement).dataset.modelId === modelId) {\n      item.classList.add('active');\n    } else {\n      item.classList.remove('active');\n    }\n  });\n  \n  // Save preference to server\n  fetch('/api/preferences', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ lastModel: modelId })\n  }).catch(() => {}); // Ignore errors\n}\n\n/**\n * Apply model from preferences\n */\nexport function applyModelPreference(prefs: Preferences): void {\n  const models = getModels();\n  if (prefs.lastModel && models.find(m => m.id === prefs.lastModel)) {\n    // Update state (also syncs hidden input)\n    stateSetSelectedModel(prefs.lastModel);\n    \n    // Update placeholder\n    const modelInfo = models.find(m => m.id === prefs.lastModel);\n    if (modelInfo) {\n      const input = document.querySelector('input[name=\"message\"]') as HTMLInputElement;\n      if (input) {\n        input.placeholder = `Ask ${modelInfo.name}...`;\n      }\n    }\n  }\n}\n", "/**\n * Image paste handling\n */\n\nimport { setHasImage } from './state.js';\n\n/**\n * Set up paste handler for image attachments\n */\nexport function setupImagePaste(): void {\n  document.addEventListener('paste', (e: ClipboardEvent) => {\n    const items = e.clipboardData?.items;\n    if (!items) return;\n\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n      if (item.type.indexOf('image') !== -1) {\n        e.preventDefault();\n        const blob = item.getAsFile();\n        if (!blob) continue;\n        \n        const reader = new FileReader();\n        \n        reader.onload = (event) => {\n          const base64 = event.target?.result as string;\n          const imageData = document.getElementById('imageData') as HTMLInputElement;\n          const previewImg = document.getElementById('previewImg') as HTMLImageElement;\n          const imagePreview = document.getElementById('imagePreview');\n          \n          if (imageData) imageData.value = base64;\n          if (previewImg) previewImg.src = base64;\n          if (imagePreview) imagePreview.classList.add('visible');\n          setHasImage(true);\n        };\n        \n        reader.onerror = (error) => console.error('FileReader error:', error);\n        reader.readAsDataURL(blob);\n        break;\n      }\n    }\n  });\n}\n\n/**\n * Remove attached image\n */\nexport function removeImage(): void {\n  const imageData = document.getElementById('imageData') as HTMLInputElement;\n  const previewImg = document.getElementById('previewImg') as HTMLImageElement;\n  const imagePreview = document.getElementById('imagePreview');\n  \n  if (imageData) imageData.value = '';\n  if (previewImg) previewImg.src = '';\n  if (imagePreview) imagePreview.classList.remove('visible');\n  setHasImage(false);\n}\n", "/**\n * UI utility functions\n */\n\n/**\n * Scroll chat to bottom\n */\nexport function scrollToBottom(): void {\n  // Try chatView first (the scrollable container for chat messages)\n  const chatView = document.getElementById('chatView');\n  if (chatView) {\n    console.log('[SCROLL] chatView before:', chatView.scrollTop, 'scrollHeight:', chatView.scrollHeight, 'clientHeight:', chatView.clientHeight);\n    chatView.scrollTop = chatView.scrollHeight;\n    console.log('[SCROLL] chatView after:', chatView.scrollTop);\n  }\n}\n\n/**\n * HTML escape helper\n */\nexport function escapeHtml(text: string): string {\n  const map: Record<string, string> = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;'\n  };\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}\n\n/**\n * Format relative time\n */\nexport function formatAge(dateStr: string | undefined): string {\n  if (!dateStr) return '';\n  \n  const now = Date.now();\n  const then = new Date(dateStr).getTime();\n  const diffMs = now - then;\n  \n  const minutes = Math.floor(diffMs / 60000);\n  const hours = Math.floor(diffMs / 3600000);\n  const days = Math.floor(diffMs / 86400000);\n  const weeks = Math.floor(days / 7);\n  const months = Math.floor(days / 30);\n  const years = Math.floor(days / 365);\n  \n  if (years >= 1) return `${years} year${years > 1 ? 's' : ''}`;\n  if (months >= 1) return `${months} month${months > 1 ? 's' : ''}`;\n  if (weeks >= 1) return `${weeks} week${weeks > 1 ? 's' : ''}`;\n  if (days >= 1) return `${days} day${days > 1 ? 's' : ''}`;\n  if (hours >= 1) return `${hours} hour${hours > 1 ? 's' : ''}`;\n  if (minutes >= 1) return `${minutes} min`;\n  return 'just now';\n}\n", "/**\n * History and preferences loading\n */\n\nimport type { Preferences } from './types.js';\nimport { scrollToBottom } from './ui-utils.js';\nimport { applyModelPreference, showNewChat, hideNewChat } from './model-selector.js';\nimport { initFromPreferences } from './state.js';\n\n// Declare renderMarkdown as a global function from markdown-renderer.js\ndeclare global {\n  interface Window {\n    renderMarkdown?: () => void;\n  }\n}\n\n/**\n * Load conversation history on page load\n */\nexport async function loadHistory(): Promise<void> {\n  try {\n    const response = await fetch('/api/history');\n    if (response.ok) {\n      const html = await response.text();\n      const chat = document.getElementById('chat');\n      if (chat && html.trim()) {\n        // Has messages - show chat, hide new chat form\n        chat.innerHTML = html;\n        hideNewChat();\n        // Render any markdown in loaded messages\n        if (typeof window.renderMarkdown === 'function') {\n          window.renderMarkdown();\n        }\n        // Note: caller should scroll after view is visible\n      } else {\n        // No messages - show new chat form\n        showNewChat();\n      }\n    } else {\n      // Error loading - show new chat form\n      showNewChat();\n    }\n  } catch (error) {\n    console.error('Failed to load history:', error);\n    showNewChat();\n  }\n}\n\n/**\n * Load and apply user preferences\n * @returns true if there's an active session\n */\nexport async function loadPreferences(): Promise<boolean> {\n  try {\n    const response = await fetch('/api/preferences');\n    if (response.ok) {\n      const prefs: Preferences = await response.json();\n      \n      // Initialize state from preferences\n      initFromPreferences(prefs);\n      \n      // Apply model to UI (placeholder text)\n      applyModelPreference(prefs);\n      \n      // Return whether we have an active session\n      return prefs.lastSessionId != null;\n    }\n  } catch (error) {\n    console.error('Failed to load preferences:', error);\n  }\n  return false;\n}\n", "/**\n * Session panel management\n */\n\nimport type { SessionsResponse, SessionData } from './types.js';\nimport { formatAge, scrollToBottom } from './ui-utils.js';\nimport { getActiveSessionId, getCurrentCwd, setActiveSession } from './state.js';\nimport { setAvailableModels, showNewChat, hideNewChat } from './model-selector.js';\nimport { loadHistory } from './history.js';\n\n/**\n * Show session manager as the main view (landing page)\n * Different from toggleSessionPanel - this is for initial page load\n */\nexport function showSessionManager(): void {\n  const chatView = document.getElementById('chatView');\n  const sessionView = document.getElementById('sessionView');\n  const footer = document.getElementById('chatFooter');\n  const menuBtn = document.getElementById('menuBtn');\n  \n  if (!chatView || !sessionView) return;\n  \n  // Switch to session view\n  chatView.classList.remove('active');\n  sessionView.classList.add('active');\n  footer?.classList.add('hidden');\n  menuBtn?.classList.add('active');\n  \n  // Load sessions\n  loadSessions();\n}\n\n/**\n * Toggle session panel visibility\n */\nexport function toggleSessionPanel(): void {\n  const chatView = document.getElementById('chatView');\n  const sessionView = document.getElementById('sessionView');\n  const footer = document.getElementById('chatFooter');\n  const menuBtn = document.getElementById('menuBtn');\n  \n  if (!chatView || !sessionView) return;\n  \n  const isSessionView = sessionView.classList.contains('active');\n  \n  if (isSessionView) {\n    // Switch to chat view\n    sessionView.classList.remove('active');\n    chatView.classList.add('active');\n    footer?.classList.remove('hidden');\n    menuBtn?.classList.remove('active');\n    \n    // Check if we have chat messages - if not, show new chat form with models\n    const chat = document.getElementById('chat');\n    if (chat && chat.children.length === 0) {\n      showNewChat(getCurrentCwd());\n    }\n  } else {\n    // Switch to session view\n    chatView.classList.remove('active');\n    sessionView.classList.add('active');\n    footer?.classList.add('hidden');\n    menuBtn?.classList.add('active');\n    // Load sessions when opening\n    loadSessions();\n  }\n}\n\n/**\n * Load and render sessions\n */\nexport async function loadSessions(): Promise<void> {\n  try {\n    const response = await fetch('/api/sessions');\n    if (!response.ok) return;\n    \n    const data: SessionsResponse = await response.json();\n    const { activeSessionId, currentCwd, grouped, models } = data;\n    \n    // Update state store\n    setActiveSession(activeSessionId, currentCwd);\n    \n    // Store available models from SDK\n    if (models && models.length > 0) {\n      setAvailableModels(models);\n    }\n    \n    const container = document.getElementById('sessionList');\n    if (!container) return;\n    \n    container.innerHTML = '';\n    \n    // Sort cwds: current first, then alphabetically\n    const cwds = Object.keys(grouped).sort((a, b) => {\n      if (a === currentCwd) return -1;\n      if (b === currentCwd) return 1;\n      return a.localeCompare(b);\n    });\n    \n    for (const cwd of cwds) {\n      const sessions = grouped[cwd];\n      \n      // Handle unknown cwd sessions - just show a summary\n      if (cwd === '(unknown)' || !cwd) {\n        const summary = document.createElement('div');\n        summary.className = 'cwd-header omitted';\n        summary.textContent = `no cwd (${sessions.length} omitted)`;\n        container.appendChild(summary);\n        continue;\n      }\n      \n      // CWD header\n      const cwdHeader = document.createElement('div');\n      cwdHeader.className = 'cwd-header';\n      cwdHeader.textContent = cwd === currentCwd ? `${cwd} (current)` : cwd;\n      container.appendChild(cwdHeader);\n      \n      // Session items\n      for (const session of sessions) {\n        const item = createSessionItem(session, activeSessionId);\n        container.appendChild(item);\n      }\n    }\n  } catch (error) {\n    console.error('Failed to load sessions:', error);\n  }\n}\n\n/**\n * Create a session item element\n */\nfunction createSessionItem(session: SessionData, activeSessionId: string): HTMLElement {\n  const item = document.createElement('div');\n  item.className = 'session-item';\n  if (session.sessionId === activeSessionId) {\n    item.classList.add('active');\n  }\n  item.dataset.sessionId = session.sessionId;\n  \n  // Summary text (truncated)\n  const summarySpan = document.createElement('span');\n  summarySpan.className = 'session-summary';\n  const summary = session.summary || 'No summary';\n  const age = session.updatedAt ? ` (${formatAge(session.updatedAt)})` : '';\n  summarySpan.textContent = summary + age;\n  summarySpan.onclick = () => switchSession(session.sessionId);\n  item.appendChild(summarySpan);\n  \n  // Delete button\n  const deleteBtn = document.createElement('button');\n  deleteBtn.className = 'session-delete';\n  deleteBtn.textContent = '\u00D7';\n  deleteBtn.onclick = (e) => {\n    e.stopPropagation();\n    deleteSession(session.sessionId, session.summary);\n  };\n  item.appendChild(deleteBtn);\n  \n  return item;\n}\n\n/**\n * Switch to a different session\n */\nexport async function switchSession(sessionId: string): Promise<void> {\n  // If already on this session, just close the panel and scroll to bottom\n  if (sessionId === getActiveSessionId()) {\n    toggleSessionPanel();\n    scrollToBottom();\n    return;\n  }\n  \n  // Show loading state on clicked item\n  const clickedItem = document.querySelector(`.session-item[data-session-id=\"${sessionId}\"]`);\n  if (clickedItem) {\n    clickedItem.classList.add('loading');\n  }\n  \n  try {\n    const response = await fetch(`/api/sessions/${sessionId}/resume`, {\n      method: 'POST'\n    });\n    \n    if (response.ok) {\n      const data = await response.json();\n      // Update client state with new session\n      setActiveSession(data.sessionId, data.cwd || getCurrentCwd());\n      \n      // Load history (this calls hideNewChat if there's content)\n      await loadHistory();\n      \n      // Switch to chat view directly (not toggleSessionPanel which has extra logic)\n      const chatView = document.getElementById('chatView');\n      const sessionView = document.getElementById('sessionView');\n      const footer = document.getElementById('chatFooter');\n      const menuBtn = document.getElementById('menuBtn');\n      \n      sessionView?.classList.remove('active');\n      chatView?.classList.add('active');\n      footer?.classList.remove('hidden');\n      menuBtn?.classList.remove('active');\n      \n      // Scroll after view is visible and content is painted\n      requestAnimationFrame(() => scrollToBottom());\n    } else {\n      const err = await response.json();\n      if (clickedItem) clickedItem.classList.remove('loading');\n      alert('Failed to switch session: ' + err.error);\n    }\n  } catch (error) {\n    console.error('Failed to switch session:', error);\n    if (clickedItem) clickedItem.classList.remove('loading');\n  }\n}\n\n/**\n * Delete a session\n */\nexport async function deleteSession(sessionId: string, summary?: string): Promise<void> {\n  const displayName = summary || sessionId.slice(0, 8);\n  if (!confirm(`Delete session \"${displayName}\"?\\n\\nThis cannot be undone.`)) {\n    return;\n  }\n  \n  try {\n    const response = await fetch(`/api/sessions/${sessionId}`, {\n      method: 'DELETE'\n    });\n    \n    if (response.ok) {\n      const data = await response.json();\n      \n      // If we deleted the active session, show new chat form\n      if (data.wasActive) {\n        const chat = document.getElementById('chat');\n        if (chat) chat.innerHTML = '';\n        showNewChat(getCurrentCwd());\n      }\n      \n      // If no sessions left, stay in session manager with just \"new chat\" button\n      // The loadSessions call will show empty list\n      loadSessions();\n    } else {\n      const err = await response.json();\n      alert('Failed to delete session: ' + err.error);\n    }\n  } catch (error) {\n    console.error('Failed to delete session:', error);\n    alert('Failed to delete session: ' + (error as Error).message);\n  }\n}\n\n/**\n * Show new chat UI (switches from session manager to chat view with new chat form)\n */\nexport function showNewChatUI(): void {\n  const chatView = document.getElementById('chatView');\n  const sessionView = document.getElementById('sessionView');\n  const footer = document.getElementById('chatFooter');\n  const chat = document.getElementById('chat');\n  const menuBtn = document.getElementById('menuBtn');\n  \n  if (chatView && sessionView) {\n    // Switch to chat view\n    sessionView.classList.remove('active');\n    chatView.classList.add('active');\n    footer?.classList.remove('hidden');\n    menuBtn?.classList.remove('active');\n    \n    // Clear old chat and show new chat form with last cwd\n    if (chat) chat.innerHTML = '';\n    showNewChat(getCurrentCwd());\n    \n    // Focus the message input\n    const messageInput = document.querySelector('form input[name=\"message\"]') as HTMLInputElement;\n    messageInput?.focus();\n  }\n}\n", "/**\n * Main entry point - ties all modules together\n */\n\nimport { setupImagePaste, removeImage } from './image-paste.js';\nimport { scrollToBottom } from './ui-utils.js';\nimport { loadHistory, loadPreferences } from './history.js';\nimport { toggleSessionPanel, switchSession, deleteSession, showSessionManager, showNewChatUI } from './session-panel.js';\nimport { selectModel, loadModels, showNewChat } from './model-selector.js';\nimport { toggleActivityBox } from './activity.js';\nimport { setupFormHandler, stopStreaming } from './streaming.js';\n\n// Export functions to global scope for onclick handlers in HTML\ndeclare global {\n  interface Window {\n    removeImage: typeof removeImage;\n    scrollToBottom: typeof scrollToBottom;\n    toggleSessionPanel: typeof toggleSessionPanel;\n    showNewChat: typeof showNewChatUI;\n    switchSession: typeof switchSession;\n    deleteSession: typeof deleteSession;\n    selectModel: typeof selectModel;\n    loadModels: typeof loadModels;\n    toggleActivityBox: typeof toggleActivityBox;\n    stopStreaming: typeof stopStreaming;\n  }\n}\n\n// Attach to window for HTML onclick handlers\nwindow.removeImage = removeImage;\nwindow.scrollToBottom = scrollToBottom;\nwindow.toggleSessionPanel = toggleSessionPanel;\nwindow.showNewChat = showNewChatUI;\nwindow.switchSession = switchSession;\nwindow.deleteSession = deleteSession;\nwindow.selectModel = selectModel;\nwindow.loadModels = loadModels;\nwindow.toggleActivityBox = toggleActivityBox;\nwindow.stopStreaming = stopStreaming;\n\n// Scroll to bottom when new messages arrive (HTMX)\ndocument.body.addEventListener('htmx:afterSwap', () => {\n  scrollToBottom();\n});\n\n// Initialize on page load\ndocument.addEventListener('DOMContentLoaded', async () => {\n  // Set up event handlers\n  setupImagePaste();\n  setupFormHandler();\n  \n  // Fetch models once on page load\n  try {\n    const response = await fetch('/api/sessions');\n    if (response.ok) {\n      const data = await response.json();\n      if (data.models && data.models.length > 0) {\n        const { setAvailableModels } = await import('./model-selector.js');\n        setAvailableModels(data.models);\n      }\n    }\n  } catch (e) {\n    console.error('Failed to fetch models on startup:', e);\n  }\n  \n  // Load preferences to check for active session\n  const hasActiveSession = await loadPreferences();\n  \n  if (hasActiveSession) {\n    // Active session exists - show chat with history\n    loadHistory();\n  } else {\n    // No active session - show session manager as landing page\n    showSessionManager();\n  }\n});\n", "/**\n * Activity box management\n */\n\nimport type { ToolEventData } from './types.js';\n\n/**\n * Add activity item to activity box\n */\nexport function addActivityItem(type: string, text: string, details: string | null = null): void {\n  const activityBox = document.querySelector('#pending-response .activity-box');\n  if (!activityBox) return;\n  \n  const item = document.createElement('div');\n  item.className = `activity-item ${type}`;\n  \n  if (details) {\n    // Create expandable item with details\n    const summary = document.createElement('div');\n    summary.className = 'activity-summary';\n    summary.textContent = text;\n    summary.onclick = () => item.classList.toggle('expanded');\n    item.appendChild(summary);\n    \n    const detailsDiv = document.createElement('div');\n    detailsDiv.className = 'activity-details';\n    detailsDiv.textContent = details;\n    item.appendChild(detailsDiv);\n  } else {\n    item.textContent = text;\n  }\n  \n  activityBox.appendChild(item);\n  \n  // Update activity count in header\n  const wrapper = activityBox.closest('.activity-wrapper');\n  if (wrapper) {\n    const count = activityBox.querySelectorAll('.activity-item').length;\n    const countSpan = wrapper.querySelector('.activity-count');\n    if (countSpan) countSpan.textContent = `(${count})`;\n  }\n  \n  // Auto-scroll activity box\n  activityBox.scrollTop = activityBox.scrollHeight;\n}\n\n/**\n * Toggle activity box expand/collapse\n */\nexport function toggleActivityBox(header: HTMLElement): void {\n  const wrapper = header.closest('.activity-wrapper');\n  if (!wrapper) return;\n  \n  const isCollapsed = wrapper.classList.contains('collapsed');\n  wrapper.classList.toggle('collapsed');\n  \n  // Update icon\n  const icon = header.querySelector('.activity-icon');\n  if (icon) {\n    icon.textContent = isCollapsed ? '\u25BC' : '\u25B6';\n  }\n}\n\n/**\n * Format tool arguments for display\n */\nexport function formatToolArgs(args: Record<string, unknown> | undefined): string {\n  if (!args) return '';\n  \n  const parts: string[] = [];\n  for (const [key, value] of Object.entries(args)) {\n    if (typeof value === 'string') {\n      // Truncate long strings\n      const display = value.length > 80 ? value.substring(0, 80) + '...' : value;\n      parts.push(`${key}: ${display}`);\n    } else if (typeof value === 'object') {\n      parts.push(`${key}: ${JSON.stringify(value).substring(0, 60)}...`);\n    } else {\n      parts.push(`${key}: ${value}`);\n    }\n  }\n  return parts.join(', ');\n}\n\n/**\n * Format tool result for display\n */\nexport function formatToolResult(result: ToolEventData['result']): string {\n  if (!result) return '';\n  \n  if (result.content) {\n    const content = typeof result.content === 'string' \n      ? result.content \n      : JSON.stringify(result.content);\n    return content.length > 500 ? content.substring(0, 500) + '...' : content;\n  }\n  \n  return JSON.stringify(result).substring(0, 200);\n}\n", "/**\n * Display output rendering for display-only tools\n * \n * Rendering is driven by metadata, not explicit types.\n * To add a new output type, just store the right metadata on the server.\n * \n * Rendering rules (checked in order):\n * 1. metadata.type === 'embed' or metadata.html \u2192 render as sanitized HTML (embeds, iframes)\n * 2. metadata.mimeType starts with 'image/' \u2192 render as image\n * 3. metadata.command exists \u2192 render as terminal output\n * 4. metadata.path exists \u2192 render as code file\n * 5. fallback \u2192 render data as preformatted text\n */\n\nimport type { OutputData } from './types.js';\n\n// Declare globals from external scripts\ndeclare global {\n  interface Window {\n    marked?: { parse: (md: string) => string };\n    DOMPurify?: { sanitize: (html: string, config?: Record<string, unknown>) => string };\n    hljs?: { highlightElement: (el: Element) => void };\n  }\n}\n\n// Minimal output info needed for rendering\ninterface OutputRef {\n  id: string;\n  // Type is optional - we infer from metadata\n  type?: string;\n}\n\n/**\n * Render display output from display-only tools\n * Rendering is driven by metadata, making it easy to add new output types.\n */\nexport async function renderDisplayOutput(output: OutputRef): Promise<void> {\n  if (!output?.id) return;\n  \n  const container = document.querySelector('#pending-response .outputs-container');\n  if (!container) return;\n  \n  try {\n    const response = await fetch(`/api/outputs/${output.id}?format=json`);\n    if (!response.ok) return;\n    \n    const { data, metadata }: OutputData = await response.json();\n    \n    // Dispatch based on metadata (order matters)\n    if (metadata.type === 'embed' || metadata.html) {\n      renderEmbed(container, data, metadata);\n    } else if (metadata.mimeType?.startsWith('image/')) {\n      renderImage(container, output.id, data, metadata);\n    } else if (metadata.command !== undefined) {\n      renderTerminal(container, data, metadata);\n    } else if (metadata.path) {\n      renderCode(container, data, metadata);\n    } else {\n      // Fallback: render as preformatted text\n      renderPreformatted(container, data);\n    }\n  } catch (err) {\n    console.error('Error displaying output:', err);\n  }\n}\n\n/**\n * Render embedded HTML content (YouTube, SoundCloud, etc.)\n */\nfunction renderEmbed(container: Element, data: string, metadata: OutputData['metadata']): void {\n  const div = document.createElement('div');\n  div.className = 'output-embed';\n  \n  // Use html field if present, otherwise use data directly\n  const html = metadata.html || data;\n  \n  if (window.DOMPurify) {\n    div.innerHTML = window.DOMPurify.sanitize(html, {\n      ADD_TAGS: ['iframe'],\n      ADD_ATTR: ['allow', 'allowfullscreen', 'frameborder', 'scrolling', 'src', 'width', 'height']\n    });\n  } else {\n    div.innerHTML = html;\n  }\n  \n  container.appendChild(div);\n}\n\n/**\n * Render image content\n */\nfunction renderImage(container: Element, outputId: string, data: string, metadata: OutputData['metadata']): void {\n  const img = document.createElement('img');\n  img.className = 'output-image';\n  img.src = metadata.mimeType && typeof data === 'string'\n    ? `data:${metadata.mimeType};base64,${data}`\n    : `/api/outputs/${outputId}`;\n  img.alt = metadata.path || 'Image';\n  container.appendChild(img);\n}\n\n/**\n * Render terminal/command output\n */\nfunction renderTerminal(container: Element, data: string, metadata: OutputData['metadata']): void {\n  const exitInfo = metadata.exitCode === 0 ? '' : ` (exit ${metadata.exitCode})`;\n  const markdown = '```bash\\n$ ' + metadata.command + exitInfo + '\\n' + data + '\\n```';\n  renderMarkdown(container, markdown, 'output-terminal');\n}\n\n/**\n * Render code/file content\n */\nfunction renderCode(container: Element, data: string, metadata: OutputData['metadata']): void {\n  const lang = metadata.highlight || '';\n  const pathInfo = metadata.path ? `**${metadata.path}**` : '';\n  const lineInfo = metadata.startLine && metadata.endLine \n    ? ` (lines ${metadata.startLine}-${metadata.endLine} of ${metadata.totalLines})`\n    : '';\n  const markdown = pathInfo + lineInfo + '\\n\\n```' + lang + '\\n' + data + '\\n```';\n  renderMarkdown(container, markdown, 'output-code');\n}\n\n/**\n * Render preformatted text (fallback)\n */\nfunction renderPreformatted(container: Element, data: string): void {\n  const pre = document.createElement('pre');\n  pre.className = 'output-raw';\n  pre.textContent = data;\n  container.appendChild(pre);\n}\n\n/**\n * Helper: render markdown and append to container\n */\nfunction renderMarkdown(container: Element, markdown: string, className: string): void {\n  if (!window.marked || !window.DOMPurify) {\n    // Fallback to preformatted\n    renderPreformatted(container, markdown);\n    return;\n  }\n  \n  const div = document.createElement('div');\n  div.className = `output-content ${className}`;\n  div.innerHTML = window.DOMPurify.sanitize(window.marked.parse(markdown));\n  container.appendChild(div);\n  \n  // Apply syntax highlighting\n  div.querySelectorAll('pre code').forEach((block) => {\n    if (window.hljs) window.hljs.highlightElement(block);\n  });\n}\n", "/**\n * SSE Streaming implementation\n */\n\nimport type { ToolEventData, MessageEventData } from './types.js';\nimport { escapeHtml, scrollToBottom } from './ui-utils.js';\nimport { addActivityItem, formatToolArgs, formatToolResult, toggleActivityBox } from './activity.js';\nimport { renderDisplayOutput } from './display-output.js';\nimport { removeImage } from './image-paste.js';\nimport { setStreaming, getActiveEventSource } from './state.js';\nimport { hideNewChat, getNewChatCwd, showNewChatError } from './model-selector.js';\n\n// Declare renderMarkdown global\ndeclare global {\n  interface Window {\n    renderMarkdown?: () => void;\n  }\n}\n\n/** Timeout for stop button appearance */\nlet stopButtonTimeout: ReturnType<typeof setTimeout> | null = null;\n\n/**\n * Add user message bubble immediately\n */\nexport function addUserBubble(message: string, hasImage: boolean): HTMLElement {\n  const chat = document.getElementById('chat');\n  if (!chat) throw new Error('Chat element not found');\n  \n  // Hide new chat form, show chat (transition from new chat to conversation)\n  hideNewChat();\n  \n  // Add user message\n  const userDiv = document.createElement('div');\n  userDiv.className = 'message user';\n  userDiv.innerHTML = `${escapeHtml(message)}${hasImage ? ' <span class=\"image-indicator\">[img]</span>' : ''}`;\n  chat.appendChild(userDiv);\n  \n  // Add pending response with activity box\n  const assistantDiv = document.createElement('div');\n  assistantDiv.className = 'message assistant pending';\n  assistantDiv.id = 'pending-response';\n  assistantDiv.setAttribute('data-markdown', '');\n  assistantDiv.innerHTML = `\n    <div class=\"activity-wrapper\">\n      <div class=\"activity-header\" onclick=\"toggleActivityBox(this)\">\n        <span class=\"activity-icon\">\u25B6</span>\n        <span class=\"activity-label\">Activity</span>\n        <span class=\"activity-count\"></span>\n      </div>\n      <div class=\"activity-box\"></div>\n    </div>\n    <div class=\"outputs-container\"></div>\n    <div class=\"markdown-content streaming-cursor\"></div>\n  `;\n  chat.appendChild(assistantDiv);\n  \n  // Scroll to bottom\n  scrollToBottom();\n  \n  return assistantDiv;\n}\n\n/**\n * Stream response via EventSource\n */\nexport function streamResponse(prompt: string, model: string, imageData: string, cwd?: string): void {\n  // Build URL with parameters\n  const params = new URLSearchParams({ prompt, model });\n  if (imageData) {\n    params.set('imageData', imageData);\n  }\n  if (cwd) {\n    params.set('cwd', cwd);\n  }\n  \n  const eventSource = new EventSource(`/api/stream?${params.toString()}`);\n  setStreaming(true, eventSource);\n  \n  const responseDiv = document.querySelector('#pending-response .markdown-content');\n  let responseContent = '';\n  let firstDeltaReceived = false;\n  \n  // Handle response text deltas\n  eventSource.addEventListener('assistant.message_delta', (e: MessageEvent) => {\n    const data: MessageEventData = JSON.parse(e.data);\n    if (data.deltaContent) {\n      responseContent += data.deltaContent;\n      if (responseDiv) responseDiv.textContent = responseContent;\n      \n      // Collapse activity wrapper on first delta\n      if (!firstDeltaReceived) {\n        const wrapper = document.querySelector('#pending-response .activity-wrapper');\n        if (wrapper) {\n          wrapper.classList.add('collapsed');\n          const icon = wrapper.querySelector('.activity-icon');\n          if (icon) icon.textContent = '\u25B6';\n        }\n        firstDeltaReceived = true;\n      }\n      \n      scrollToBottom();\n    }\n  });\n  \n  // Handle final message\n  eventSource.addEventListener('assistant.message', (e: MessageEvent) => {\n    const data: MessageEventData = JSON.parse(e.data);\n    if (data.content && responseDiv) {\n      // Set final content as text (renderMarkdown will parse it)\n      responseDiv.textContent = data.content;\n      responseDiv.classList.remove('streaming-cursor');\n      \n      // Mark as not processed so renderMarkdown will handle it\n      const pending = document.getElementById('pending-response');\n      if (pending) {\n        pending.dataset.markdownProcessed = 'false';\n      }\n      \n      // Render markdown (with DOMPurify sanitization)\n      if (typeof window.renderMarkdown === 'function') {\n        window.renderMarkdown();\n      }\n    }\n  });\n  \n  // Handle turn start\n  eventSource.addEventListener('assistant.turn_start', (e: MessageEvent) => {\n    const data = JSON.parse(e.data);\n    addActivityItem('turn', `Turn ${parseInt(data.turnId || 0) + 1}...`);\n  });\n  \n  // Handle intent\n  eventSource.addEventListener('assistant.intent', (e: MessageEvent) => {\n    const data = JSON.parse(e.data);\n    if (data.intent) {\n      addActivityItem('intent', `Intent: ${data.intent}`);\n    }\n  });\n  \n  // Handle tool execution\n  eventSource.addEventListener('tool.execution_start', (e: MessageEvent) => {\n    const data: ToolEventData = JSON.parse(e.data);\n    const toolName = data.toolName || data.name || 'tool';\n    const args = formatToolArgs(data.arguments);\n    const summary = `\u25B6 ${toolName}`;\n    const details = args ? `Arguments: ${args}` : null;\n    addActivityItem('tool', summary, details);\n  });\n  \n  eventSource.addEventListener('tool.execution_complete', (e: MessageEvent) => {\n    const data: ToolEventData = JSON.parse(e.data);\n    const toolName = data.toolName || data.name || 'tool';\n    const status = data.success ? '\u2713' : '\u2717';\n    const summary = `${status} ${toolName}`;\n    const details = data.result ? formatToolResult(data.result) : null;\n    addActivityItem('tool-result', summary, details);\n    \n    // Display output if present (from display-only tools)\n    if (data._output) {\n      renderDisplayOutput(data._output);\n    }\n  });\n  \n  // Handle errors\n  eventSource.addEventListener('session.error', (e: MessageEvent) => {\n    const data = JSON.parse(e.data);\n    addActivityItem('error', `Error: ${data.message || 'Unknown error'}`);\n  });\n  \n  eventSource.addEventListener('error', (e: MessageEvent) => {\n    const data = JSON.parse(e.data || '{}');\n    addActivityItem('error', `Error: ${data.message || 'Connection error'}`);\n  });\n  \n  // Handle completion\n  eventSource.addEventListener('done', () => {\n    eventSource.close();\n    setStreaming(false, null);\n    finishPendingResponse();\n  });\n  \n  eventSource.addEventListener('session.idle', () => {\n    // Will also receive 'done', but handle just in case\n  });\n  \n  // Handle connection errors\n  eventSource.onerror = (err) => {\n    console.error('EventSource error:', err);\n    eventSource.close();\n    setStreaming(false, null);\n    \n    // If we haven't received any content, show error\n    if (!responseContent && !firstDeltaReceived) {\n      addActivityItem('error', 'Connection lost');\n    }\n    \n    finishPendingResponse();\n  };\n}\n\n/**\n * Stop streaming response\n */\nexport function stopStreaming(): void {\n  const activeEventSource = getActiveEventSource();\n  if (activeEventSource) {\n    activeEventSource.close();\n    setStreaming(false, null);\n    \n    // Add visual feedback\n    addActivityItem('info', 'Stopped by user');\n    \n    // Mark response as stopped\n    const responseDiv = document.querySelector('#pending-response .markdown-content');\n    if (responseDiv) {\n      responseDiv.classList.remove('streaming-cursor');\n    }\n    \n    finishPendingResponse();\n  }\n}\n\n/**\n * Clean up pending response\n */\nfunction finishPendingResponse(): void {\n  const pending = document.getElementById('pending-response');\n  if (pending) {\n    pending.classList.remove('pending');\n    pending.removeAttribute('id');\n    \n    // Remove streaming cursor\n    const content = pending.querySelector('.markdown-content');\n    if (content) {\n      content.classList.remove('streaming-cursor');\n    }\n    \n    // Collapse activity wrapper when done (user can re-expand)\n    const wrapper = pending.querySelector('.activity-wrapper');\n    if (wrapper) {\n      wrapper.classList.add('collapsed');\n      const icon = wrapper.querySelector('.activity-icon');\n      if (icon) icon.textContent = '\u25B6';\n    }\n  }\n  \n  // Re-enable form\n  setFormEnabled(true);\n}\n\n/**\n * Enable/disable form during streaming\n */\nexport function setFormEnabled(enabled: boolean): void {\n  const form = document.getElementById('chatForm') as HTMLFormElement;\n  const input = form?.querySelector('input[name=\"message\"]') as HTMLInputElement;\n  const submitBtn = form?.querySelector('button[type=\"submit\"]') as HTMLButtonElement;\n  \n  if (!form || !input || !submitBtn) return;\n  \n  // Clear any pending stop button timeout\n  if (stopButtonTimeout) {\n    clearTimeout(stopButtonTimeout);\n    stopButtonTimeout = null;\n  }\n  \n  input.disabled = !enabled;\n  \n  if (enabled) {\n    // Restore to Send button\n    submitBtn.disabled = false;\n    submitBtn.textContent = 'Send';\n    submitBtn.classList.remove('stop-btn');\n    submitBtn.onclick = null;\n    input.focus();\n  } else {\n    // Briefly disable to prevent double-tap, then show Stop\n    submitBtn.disabled = true;\n    submitBtn.textContent = 'Send';\n    submitBtn.classList.remove('stop-btn');\n    \n    stopButtonTimeout = setTimeout(() => {\n      // Only show stop if still streaming\n      if (getActiveEventSource()) {\n        submitBtn.disabled = false;\n        submitBtn.textContent = 'Stop';\n        submitBtn.classList.add('stop-btn');\n        submitBtn.onclick = (e) => {\n          e.preventDefault();\n          stopStreaming();\n        };\n      }\n    }, 400);\n  }\n}\n\n/**\n * Set up form submission handler\n */\nexport function setupFormHandler(): void {\n  const form = document.getElementById('chatForm') as HTMLFormElement;\n  if (!form) return;\n  \n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    \n    const input = form.querySelector('input[name=\"message\"]') as HTMLInputElement;\n    const message = input.value.trim();\n    const modelInput = document.getElementById('selectedModel') as HTMLInputElement;\n    const model = modelInput?.value;\n    const imageData = (document.getElementById('imageData') as HTMLInputElement).value;\n    \n    // Get cwd from new chat form (will be empty if in existing chat)\n    const cwd = getNewChatCwd();\n    \n    // If new chat form is visible and cwd is empty, show error\n    const newChat = document.getElementById('newChat');\n    if (newChat && !newChat.classList.contains('hidden') && !cwd) {\n      showNewChatError('Please enter a working directory');\n      return;\n    }\n    \n    // Definitive model logging\n    console.log('[MODEL] Client sending request with model:', model || '(undefined)');\n    if (cwd) console.log('[CWD] New session cwd:', cwd);\n    \n    if (!message) return;\n    \n    // Disable form during streaming\n    setFormEnabled(false);\n    \n    // Add user bubble immediately\n    const hasImage = !!imageData;\n    addUserBubble(message, hasImage);\n    \n    // Clear input and image\n    input.value = '';\n    removeImage();\n    \n    // Start streaming (pass cwd for new sessions)\n    streamResponse(message, model, imageData, cwd);\n  });\n}\n"],
  "mappings": "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",
  "names": ["getActiveSessionId", "state", "getCurrentCwd", "getSelectedModel", "getActiveEventSource", "setActiveSession", "sessionId", "cwd", "setSelectedModel", "modelId", "input", "setStreaming", "streaming", "eventSource", "setHasImage", "hasImage", "initFromPreferences", "prefs", "DEFAULT_MODEL", "init_state", "__esmMin", "model_selector_exports", "__export", "applyModelPreference", "getNewChatCwd", "hideNewChat", "loadModels", "selectModel", "setAvailableModels", "showNewChat", "showNewChatError", "models", "availableModels", "m", "getModels", "FALLBACK_MODELS", "prefillCwd", "newChat", "chat", "cwdInput", "errorDiv", "message", "container", "currentModel", "getSelectedModel", "model", "item", "nameSpan", "costSpan", "modelId", "setSelectedModel", "modelInfo", "input", "prefs", "init_model_selector", "__esmMin", "init_state", "init_state", "setupImagePaste", "items", "i", "item", "blob", "reader", "event", "base64", "imageData", "previewImg", "imagePreview", "setHasImage", "error", "removeImage", "scrollToBottom", "chatView", "escapeHtml", "text", "map", "m", "formatAge", "dateStr", "now", "then", "diffMs", "minutes", "hours", "days", "weeks", "months", "years", "init_model_selector", "init_state", "loadHistory", "response", "html", "chat", "hideNewChat", "showNewChat", "error", "loadPreferences", "prefs", "initFromPreferences", "applyModelPreference", "init_state", "init_model_selector", "showSessionManager", "chatView", "sessionView", "footer", "menuBtn", "loadSessions", "toggleSessionPanel", "chat", "showNewChat", "getCurrentCwd", "response", "data", "activeSessionId", "currentCwd", "grouped", "models", "setActiveSession", "setAvailableModels", "container", "cwds", "a", "b", "cwd", "sessions", "summary", "cwdHeader", "session", "item", "createSessionItem", "error", "summarySpan", "age", "formatAge", "switchSession", "deleteBtn", "e", "deleteSession", "sessionId", "getActiveSessionId", "scrollToBottom", "clickedItem", "loadHistory", "err", "displayName", "showNewChatUI", "init_model_selector", "addActivityItem", "type", "text", "details", "activityBox", "item", "summary", "detailsDiv", "wrapper", "count", "countSpan", "toggleActivityBox", "header", "isCollapsed", "icon", "formatToolArgs", "args", "parts", "key", "value", "display", "formatToolResult", "result", "content", "renderDisplayOutput", "output", "container", "response", "data", "metadata", "renderEmbed", "renderImage", "renderTerminal", "renderCode", "renderPreformatted", "err", "div", "html", "outputId", "img", "exitInfo", "markdown", "renderMarkdown", "lang", "pathInfo", "lineInfo", "pre", "className", "block", "init_state", "init_model_selector", "stopButtonTimeout", "addUserBubble", "message", "hasImage", "chat", "hideNewChat", "userDiv", "escapeHtml", "assistantDiv", "scrollToBottom", "streamResponse", "prompt", "model", "imageData", "cwd", "params", "eventSource", "setStreaming", "responseDiv", "responseContent", "firstDeltaReceived", "e", "data", "wrapper", "icon", "pending", "addActivityItem", "toolName", "args", "formatToolArgs", "summary", "details", "formatToolResult", "renderDisplayOutput", "finishPendingResponse", "err", "stopStreaming", "activeEventSource", "getActiveEventSource", "content", "setFormEnabled", "enabled", "form", "input", "submitBtn", "setupFormHandler", "getNewChatCwd", "newChat", "showNewChatError", "removeImage", "removeImage", "scrollToBottom", "toggleSessionPanel", "showNewChatUI", "switchSession", "deleteSession", "selectModel", "loadModels", "toggleActivityBox", "stopStreaming", "setupImagePaste", "setupFormHandler", "response", "data", "setAvailableModels", "e", "loadPreferences", "loadHistory", "showSessionManager"]
}
